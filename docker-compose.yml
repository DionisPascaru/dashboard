version: "3"
services:
    dashboard_app:
        container_name: dashboard_app
        build:
            context: .
            dockerfile: ./docker/php/Dockerfile
        expose:
            - 9000
        volumes:
            - .:/usr/src/app
            - ./public:/usr/src/app/public
        depends_on:
            - dashboard_db
        networks:
            - app_network
        restart: unless-stopped

    dashboard_nginx:
        container_name: dashboard_nginx
        build:
            context: .
            dockerfile: ./docker/nginx/Dockerfile
        volumes:
            - ./public:/usr/src/app/public
        ports:
            - "8000:80"
        depends_on:
            - dashboard_app
        environment:
            NGINX_FPM_HOST: dashboard_app
            NGINX_ROOT: .:/usr/src/app/public
        networks:
            - app_network
        restart: unless-stopped

    dashboard_db:
        image: mariadb:10.5
        container_name: dashboard_db
        volumes:
            - "./data:/var/lib/mysql"
        ports:
            - "3307:3306"
        environment:
            - MYSQL_ROOT_PASSWORD=root
            - MYSQL_ROOT_USER=root
        networks:
            - app_network
        restart: unless-stopped

    dashboard_redis:
        container_name: dashboard_redis
        image: redis:latest
        ports:
            - "6379:6379"
        networks:
            - app_network
        restart: unless-stopped

networks:
    app_network:
        driver: bridge
